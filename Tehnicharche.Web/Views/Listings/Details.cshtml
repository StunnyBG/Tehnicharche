@model Tehnicharche.ViewModels.ListingDetailsViewModel
@using System.Security.Claims

<h2>@Model.Title</h2>

<div class="card p-4">
    <img src="@Model.ImageUrl"
         class="img-fluid rounded mb-3"
         onerror="this.onerror=null;this.src='/images/placeholder.png';" />

    <p class="price-tag">@Model.Price BGN</p>
    <p><strong>Category:</strong> @Model.CategoryName</p>
    <p><strong>Location:</strong> @Model.RegionName - @Model.CityName</p>

    <hr />
    <p>@Model.Description</p>

    <hr />
    <h5>Contact</h5>
    <p>
        <strong>Email:</strong>
        <a href="mailto:@Model.CreatorEmail">@Model.CreatorEmail</a>
    </p>
    @if (!string.IsNullOrWhiteSpace(Model.CreatorPhoneNumber))
    {
        <p>
            <strong>Phone:</strong>
            <a href="tel:@Model.CreatorPhoneNumber">@Model.CreatorPhoneNumber</a>
        </p>
    }

    <div class="mt-3">
        @{
            // owner check: compare current user's id to CreatorId
            var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
            var isOwner = !string.IsNullOrEmpty(currentUserId) && currentUserId == Model.CreatorId;
        }

        @if (isOwner)
        {
            <a class="btn btn-success" asp-action="Edit" asp-route-id="@Model.Id">Edit</a>
            <a class="btn btn-danger" asp-action="Delete" asp-route-id="@Model.Id">Delete</a>
        }

        <a class="btn btn-secondary" asp-action="Index">Back</a>
    </div>
</div>
